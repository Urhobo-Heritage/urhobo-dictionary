<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urhobo-English Dictionary</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons (stars, mail, book) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font and a fallback */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f0; /* Fallback background color */
            background-image: linear-gradient(to bottom right, #e0f2f7, #c1e7f0); /* Light blue gradient for a fresh feel */
        }
        /* Styling for the subtle background logo pattern */
        .bg-pattern {
            background-image: url('https://ia600904.us.archive.org/35/items/urhobo-heritage-logo/Urhobo%20Heritage%20Logo.png');
            background-repeat: repeat; /* Repeat the logo to create a pattern */
            background-size: 200px; /* Control the size of individual logos in the pattern */
            opacity: 0.05; /* Make the pattern very subtle */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Place behind other content */
        }
        /* Custom styles to hide the download button in HTML5 audio players */
        audio::-webkit-media-controls-enclosure {
            overflow: hidden; /* Hide overflow content */
        }
        audio::-webkit-media-controls-panel {
            width: 100%; /* Ensure the control panel takes full width */
        }
        /* Keep essential audio controls visible */
        audio::-webkit-media-controls-play-button,
        audio::-webkit-media-controls-volume-slider,
        audio::-webkit-media-controls-timeline,
        audio::-webkit-media-controls-current-time-display,
        audio::-webkit-media-controls-time-remaining-display {
            display: flex !important;
        }
        /* Explicitly hide the download button */
        audio::-webkit-media-controls-download-button,
        audio::-webkit-media-controls-enclosure button[download] {
            display: none !important;
        }
        /* Make audio player fill its container */
        audio {
            width: 100%;
        }
    </style>
</head>
<body class="min-h-screen text-gray-800 relative overflow-hidden">
    <!-- Background pattern using the provided logo -->
    <div class="bg-pattern"></div>

    <div class="container mx-auto p-4 md:p-8 relative z-10">

        <!-- Header Section -->
        <header class="text-center mb-8 bg-[#02a95c] text-white p-6 rounded-lg shadow-lg">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-2">Urhobo-English Dictionary</h1>
            <p class="text-xl md:text-2xl font-light italic">"Preserving and Sharing My Urhobo Heritage"</p>
        </header>

        <!-- Action Buttons Section -->
        <nav class="flex flex-wrap justify-center gap-4 mb-8">
            <a href="https://flutterwave.com/donate/gmdq9wcmzuf7" target="_blank" class="flex items-center bg-[#8c6c43] hover:bg-[#a6865c] text-white font-semibold py-3 px-6 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                <span class="mr-2 text-xl">üíù</span> Support This Project
            </a>
            <a href="mailto:urhoboheritage23@gmail.com" class="flex items-center bg-[#51701f] hover:bg-[#6b912b] text-white font-semibold py-3 px-6 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                <span class="mr-2 text-xl">üìù</span> Submit Feedback
            </a>
            <a href="https://www.choglobal.com.ng/ca/uh" target="_blank" class="flex items-center bg-[#02a95c] hover:bg-[#03c06e] text-white font-semibold py-3 px-6 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                <span class="mr-2 text-xl">üìù</span> Book an Urhobo Language Class
            </a>
        </nav>

        <!-- Search Bar Section -->
        <div class="mb-8 p-4 bg-white rounded-lg shadow-md">
            <input type="text" id="searchInput" placeholder="Search Urhobo or English words..." class="w-full p-4 text-lg border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#02a95c] transition duration-200">
        </div>

        <!-- Dictionary Results Container -->
        <div id="resultsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Dictionary entries will be dynamically injected here by JavaScript -->
        </div>

        <!-- No Results Message (initially hidden) -->
        <div id="noResults" class="hidden text-center text-gray-600 text-lg my-8 p-6 bg-white rounded-lg shadow-md">
            <p>No results found for your search. Please try a different word.</p>
        </div>

        <!-- Footer Section -->
        <footer class="mt-12 p-8 bg-[#8c6c43] text-white rounded-lg shadow-lg">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-sm md:text-base">
                <div>
                    <h3 class="font-bold text-xl mb-3 border-b-2 border-white pb-2">About This Dictionary</h3>
                    <p class="mb-2">Produced by: Urhobo Heritage</p>
                    <p class="mb-2">Lead Contributor & Editor-in-Chief: Abednego Oghenechovwiere Omashone</p>
                    <p class="text-xs md:text-sm italic">All materials in this dictionary are the intellectual properties of Abednego Oghenechovwiere Omashone. No part of it may be reproduced, repurposed or transmitted in another medium without written permission.</p>
                </div>
                <div>
                    <h3 class="font-bold text-xl mb-3 border-b-2 border-white pb-2">Contact & Inquiries</h3>
                    <p class="mb-2">Email: <a href="mailto:urhoboheritage23@gmail.com" class="text-white hover:underline">urhoboheritage23@gmail.com</a> | <a href="mailto:choglobalconcepts@gmail.com" class="text-white hover:underline">choglobalconcepts@gmail.com</a></p>
                    <p class="mb-2">Phone/WhatsApp: +234 703 198 3620</p>
                    <p class="text-xs md:text-sm italic">This project came to you at no cost. A voluntary donation for its sustenance and enlargement is highly appreciated.</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Dictionary data (simulated from 'Urhobo Dictionary Project1.xlsx - Dictionary.csv').
        // In a live GitHub Pages deployment, you would typically fetch this CSV file
        // dynamically using JavaScript's `fetch` API and parse it (e.g., using Papa Parse library).
        // For demonstration, a small sample of the data is hardcoded here.
        const dictionaryData = [
            {
                "UBIOTA": "Abaka",
                "POS": "N",
                "UBIOTA AUDIO": "https://archive.org/download/Abaka/Abaka%20.mp3",
                "TRANSLATION": "Grasshopper (n)",
                "ILLUSTRATION": "https://ia601002.us.archive.org/33/items/afioto-re-oyibo-rabbit/Abaka%20-%20grasshopper.png",
                "UDJE 1": "Abaka ri·∫π ·∫πbe r·∫π en·∫π m·∫π na.",
                "UDJE 1 AUDIO": "https://archive.org/download/aberen-s-2/abaka%20s1.aac",
                "EXAMPLE 1": "Grashopper ate my yam's leaves.",
                "UDJE 2": "Ya j·∫π abaka na vwo; wo hwe-e.",
                "UDJE 2 AUDIO": "https://archive.org/download/aberen-s-2/abaka%20s2.aac",
                "EXAMPLE 2": "Leave the grahopper alone; do not kill it.",
                "Total_Rating_Sum": 10, // Sum of all ratings given so far
                "Rating_Count": 2     // Number of ratings received
            },
            {
                "UBIOTA": "Abamwa",
                "POS": "N",
                "UBIOTA AUDIO": "https://archive.org/download/aberen-s-2/abamwa%20.aac",
                "TRANSLATION": "rag, piece of cloth, torn piece of cloth",
                "ILLUSTRATION": "https://dn721805.ca.archive.org/0/items/afioto-re-oyibo-rabbit/abamwa.jpeg",
                "UDJE 1": "Abamwa y·∫π oku phiy·ªç rhe etin·∫π.",
                "UDJE 1 AUDIO": "https://archive.org/download/aberen-s-2/abamwa%20s1.aac",
                "EXAMPLE 1": "The rag fell into the pot.",
                "UDJE 2": "Vwo obamwa ro rhi·∫π vwe ogba.",
                "UDJE 2 AUDIO": "https://archive.org/download/aberen-s-2/abamwa%20s2.aac",
                "EXAMPLE 2": "Take the rag that fell into the well.",
                "Total_Rating_Sum": 15,
                "Rating_Count": 3
            },
            {
                "UBIOTA": "Abarikp·ªç",
                "POS": "V",
                "UBIOTA AUDIO": "https://archive.org/download/aberen-s-2/Abarikpo.aac",
                "TRANSLATION": "to embrace",
                "ILLUSTRATION": "https://ia903407.us.archive.org/1/items/abere-okoko/abarikpo.jpeg",
                "UDJE 1": "Obo n‚Äôo vwo abaripo omotete na.",
                "UDJE 1 AUDIO": "https://archive.org/download/aberen-s-2/abarikpo%20s1.aac",
                "EXAMPLE 1": "How he embraced the child.",
                "UDJE 2": "Dia r‚Äôobaripo omote na.",
                "UDJE 2 AUDIO": "https://archive.org/download/aberen-s-2/abarikpo%20s2.aac",
                "EXAMPLE 2": "Come and embrace the girl.",
                "Total_Rating_Sum": 20,
                "Rating_Count": 4
            },
            {
                "UBIOTA": "Afia",
                "POS": "N",
                "UBIOTA AUDIO": "https://archive.org/download/Afia/Afia%20.mp3",
                "TRANSLATION": "White chalk (n)",
                "ILLUSTRATION": "https://ia800902.us.archive.org/21/items/urhobo-dictionary-illustration-3/Afia%20-%20White%20chalk.png",
                "UDJE 1": "Afia ke vwo fi urhobo.",
                "UDJE 1 AUDIO": "https://archive.org/download/aberen-s-2/afia%20s1.aac",
                "EXAMPLE 1": "The Urhobo people use white chalk.",
                "UDJE 2": "Afia r‚Äôo vwo kpot·ªç na.",
                "UDJE 2 AUDIO": "https://archive.org/download/aberen-s-2/afia%20s2.aac",
                "EXAMPLE 2": "The white chalk that fell on the ground.",
                "Total_Rating_Sum": 25,
                "Rating_Count": 5
            },
            {
                "UBIOTA": "Ejeba",
                "POS": "N",
                "UBIOTA AUDIO": "https://archive.org/download/Ejeba/Ejeba%20.mp3",
                "TRANSLATION": "Chewing stick",
                "ILLUSTRATION": "https://ia600902.us.archive.org/21/items/urhobo-dictionary-illustration-3/Ejeba%20-%20Chewing%20stick.png",
                "UDJE 1": "Ejeba m·∫π na vw'·ªçf·ªçn.",
                "UDJE 1 AUDIO": "https://archive.org/download/aberen-s-2/ejeba%20s1.aac",
                "EXAMPLE 1": "My chewing stick is good.",
                "UDJE 2": "Wo gba vw'ejeba na.",
                "UDJE 2 AUDIO": "https://archive.org/download/aberen-s-2/ejeba%20s2.aac",
                "EXAMPLE 2": "Don't use this chewing stick.",
                "Total_Rating_Sum": 18,
                "Rating_Count": 4
            }
        ];

        // Get references to DOM elements
        const searchInput = document.getElementById('searchInput');
        const resultsContainer = document.getElementById('resultsContainer');
        const noResultsMessage = document.getElementById('noResults');
        let sessionStartTime = Date.now(); // Records the start time of the user's session

        /**
         * Generates a formatted timestamp string (YYYY-MM-DD HH:MM:SS).
         * @returns {string} The formatted timestamp.
         */
        function getTimestamp() {
            const now = new Date();
            const pad = (num) => num.toString().padStart(2, '0'); // Helper to add leading zero
            return `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
        }

        /**
         * Logs user interactions to the console.
         * IMPORTANT: For actual persistence to a Google Sheet (as requested),
         * this function would need to send data to a backend service (e.g., Google Apps Script,
         * Firebase Functions, or a custom server) which can then write to the sheet.
         * Client-side JavaScript on GitHub Pages cannot directly write to Google Drive files.
         *
         * @param {string} feature - The type of feature interacted with (e.g., "Search", "Audio Play", "Rate Entry").
         * @param {string} details - Specific details about the interaction.
         * @param {string} searchQuery - The current search query, if applicable.
         * @param {string} status - The status of the interaction (e.g., "Success", "Failed", "No Results").
         */
        function logInteraction(feature, details, searchQuery = '', status = 'Success') {
            const duration = Math.floor((Date.now() - sessionStartTime) / 1000); // Session duration in seconds
            const userAgent = navigator.userAgent; // User's browser and OS information
            const ipAddress = "Not Available Client-Side"; // IP address cannot be directly obtained from client-side JS for security/privacy reasons

            const logEntry = {
                Timestamp: getTimestamp(),
                "Search Query": searchQuery,
                Feature: feature,
                Details: details,
                "Session Duration": duration,
                Status: status,
                "User Agent": userAgent,
                "IP Address": ipAddress
            };
            console.log("Interaction Log:", logEntry); // Log to console for demonstration
            // In a production environment with a backend, you would typically use:
            // fetch('/api/log-interaction', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify(logEntry)
            // });
        }

        /**
         * Renders the dictionary entries into the results container based on the provided array.
         * Creates HTML cards for each entry, including audio players and rating stars.
         * @param {Array} entries - The array of dictionary entry objects to render.
         */
        function renderResults(entries) {
            resultsContainer.innerHTML = ''; // Clear previous results before rendering new ones

            // Show/hide no results message based on search outcome
            if (entries.length === 0) {
                noResultsMessage.classList.remove('hidden');
                return; // Exit if no entries to render
            } else {
                noResultsMessage.classList.add('hidden');
            }

            entries.forEach(entry => {
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 relative';

                // Construct the HTML for each dictionary entry card
                card.innerHTML = `
                    <h2 class="text-2xl font-bold text-[#02a95c] mb-2">${entry.UBIOTA} <span class="text-sm font-normal text-gray-500 ml-2">(${entry.POS || 'N/A'})</span></h2>
                    <p class="text-gray-700 mb-3"><span class="font-semibold">Translation:</span> ${entry.TRANSLATION}</p>

                    ${entry.ILLUSTRATION ? `
                        <div class="mb-4 text-center">
                            <img src="${entry.ILLUSTRATION}" alt="${entry.UBIOTA} illustration" class="max-w-full h-auto rounded-md shadow-sm mx-auto"
                                 onerror="this.onerror=null;this.src='https://placehold.co/200x150/e0e0e0/555555?text=No+Image';">
                        </div>` : ''}

                    <!-- Ubiota Audio Player -->
                    ${entry['UBIOTA AUDIO'] ? `
                        <div class="mb-3">
                            <span class="font-semibold text-gray-700">Ubiota Audio:</span>
                            <audio controls controlsList="nodownload" class="w-full mt-1" onplay="logInteraction('Audio Play', 'Playing Ubiota Audio for ${entry.UBIOTA}', searchInput.value)">
                                <source src="${entry['UBIOTA AUDIO']}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        </div>
                    ` : ''}
                    ${entry['UDJE 1'] ? `<p class="text-gray-700 text-sm italic mb-2"><span class="font-semibold">Udje 1:</span> "${entry['UDJE 1']}"</p>` : ''}
                    <!-- Udje 1 Audio Player -->
                    ${entry['UDJE 1 AUDIO'] ? `
                        <div class="mb-3">
                            <span class="font-semibold text-gray-700">Udje 1 Audio:</span>
                            <audio controls controlsList="nodownload" class="w-full mt-1" onplay="logInteraction('Audio Play', 'Playing Udje 1 Audio for ${entry.UBIOTA}', searchInput.value)">
                                <source src="${entry['UDJE 1 AUDIO']}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        </div>
                    ` : ''}
                    ${entry['EXAMPLE 1'] ? `<p class="text-gray-600 text-sm mb-3"><span class="font-semibold">Example 1:</span> ${entry['EXAMPLE 1']}</p>` : ''}
                    ${entry['UDJE 2'] ? `<p class="text-gray-700 text-sm italic mb-2"><span class="font-semibold">Udje 2:</span> "${entry['UDJE 2']}"</p>` : ''}
                    <!-- Udje 2 Audio Player -->
                    ${entry['UDJE 2 AUDIO'] ? `
                        <div class="mb-3">
                            <span class="font-semibold text-gray-700">Udje 2 Audio:</span>
                            <audio controls controlsList="nodownload" class="w-full mt-1" onplay="logInteraction('Audio Play', 'Playing Udje 2 Audio for ${entry.UBIOTA}', searchInput.value)">
                                <source src="${entry['UDJE 2 AUDIO']}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        </div>
                    ` : ''}
                    ${entry['EXAMPLE 2'] ? `<p class="text-gray-600 text-sm mb-4"><span class="font-semibold">Example 2:</span> ${entry['EXAMPLE 2']}</p>` : ''}

                    <!-- Rating Feature -->
                    <div class="mt-4 border-t pt-4 border-gray-200">
                        <p class="font-semibold text-gray-700 mb-2">Rate this entry:</p>
                        <div class="flex items-center space-x-1" data-ubiota="${entry.UBIOTA}">
                            ${Array(5).fill().map((_, i) => `
                                <i class="fa-solid fa-star text-gray-300 text-xl cursor-pointer hover:text-yellow-400" data-rating="${i + 1}"></i>
                            `).join('')}
                            <span class="ml-2 text-gray-600 text-sm">(<span class="current-rating"></span> average)</span>
                        </div>
                    </div>
                `;
                resultsContainer.appendChild(card);

                // Add event listeners and update visuals for the rating stars
                const ratingContainer = card.querySelector(`.flex[data-ubiota="${entry.UBIOTA}"]`);
                if (ratingContainer) {
                    const stars = ratingContainer.querySelectorAll('.fa-star');
                    const currentRatingSpan = ratingContainer.querySelector('.current-rating');

                    /**
                     * Updates the visual appearance of the stars based on the average rating.
                     * @param {number} avgRating - The calculated average rating.
                     */
                    const updateStarVisuals = (avgRating) => {
                        stars.forEach((star, index) => {
                            if (index < Math.round(avgRating)) { // Round to nearest whole star for visual
                                star.classList.remove('text-gray-300');
                                star.classList.add('text-yellow-400');
                            } else {
                                star.classList.remove('text-yellow-400');
                                star.classList.add('text-gray-300');
                            }
                        });
                        currentRatingSpan.textContent = avgRating.toFixed(1); // Display average with one decimal
                    };

                    // Calculate and display the initial average rating for the entry
                    const initialAvgRating = entry.Rating_Count > 0 ? entry.Total_Rating_Sum / entry.Rating_Count : 0;
                    updateStarVisuals(initialAvgRating);

                    // Add click event listener to each star for rating
                    stars.forEach(star => {
                        star.addEventListener('click', function() {
                            const newRating = parseInt(this.dataset.rating); // Get the selected rating (1-5)

                            // Find the corresponding entry in the dictionaryData array and update its ratings
                            const targetEntry = dictionaryData.find(d => d.UBIOTA === entry.UBIOTA);
                            if (targetEntry) {
                                targetEntry.Total_Rating_Sum += newRating; // Add the new rating to the sum
                                targetEntry.Rating_Count += 1;     // Increment the count of ratings
                                // Recalculate the updated average rating
                                const updatedAvgRating = targetEntry.Rating_Count > 0 ? targetEntry.Total_Rating_Sum / targetEntry.Rating_Count : 0;
                                updateStarVisuals(updatedAvgRating); // Update the visual stars immediately

                                // Log the rating interaction
                                logInteraction('Rate Entry', `Rated "${entry.UBIOTA}" ${newRating} stars. New average: ${updatedAvgRating.toFixed(1)}`, searchInput.value);
                            }
                        });
                    });
                }
            });
        }

        // Event listener for the search input field
        searchInput.addEventListener('input', (event) => {
            const query = event.target.value.toLowerCase().trim(); // Get and sanitize the search query
            // Filter dictionary entries based on matching Urhobo word, translation, or examples
            const filteredEntries = dictionaryData.filter(entry =>
                entry.UBIOTA.toLowerCase().includes(query) ||
                entry.TRANSLATION.toLowerCase().includes(query) ||
                (entry['EXAMPLE 1'] && entry['EXAMPLE 1'].toLowerCase().includes(query)) ||
                (entry['EXAMPLE 2'] && entry['EXAMPLE 2'].toLowerCase().includes(query))
            );
            renderResults(filteredEntries); // Render the filtered results
            // Log the search interaction
            logInteraction('Search', `Searching for: ${query}`, query, filteredEntries.length > 0 ? 'Success' : 'No Results');
        });

        // Initial render of all dictionary entries when the DOM content is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            renderResults(dictionaryData); // Display all entries initially
            logInteraction('Page Load', 'Dictionary app loaded'); // Log the initial page load
        });

        // Add a listener for beforeunload to log when the user leaves the page.
        // Note: This is not always reliable, especially on quick tab closes.
        window.addEventListener('beforeunload', () => {
            logInteraction('Session End', 'User left the page');
        });
    </script>
</body>
</html>
